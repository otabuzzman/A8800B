
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-8
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2290
002533
001000
060257
33720
XRA
A
2291
002534
001000
000062
33740
STA
DORES>
;ALLOW CRUNCHING
2292
002535
000000
001544
2293
002536 000000
002531
2294 002537 001000
000016
33760
MVI
C,5
;COUNT OF CHARS AT LEAST 5
2295
002540 000000
000005
2296
002541 001000
000021
33780
LXI
0,BUF
;SETUP DESTINATION POINTER
2297
002542 000000
001431
2298
002543 000000
002535
2299
002544 001000
000176
33800
KLOOP:
MOV
A,M
;GET CHARACTER FROM BUF
2300
002545 001000
000376
33820
CPI
" "
;IS IT A SPACE WE WANT TO SAVE
2301
002546 000000
000040
2302
002547 001000
000312
33840
JZ
STUFFH
IYES, STUFF IN DESTINATION LINE.
2303
002550 000000
002667
2304
002551 000000
002542'
2305
002552'
001000
000107
33860
MOV
B,A
;GET A CHARACTER FROM THE LINE
2306
33880
;SETUP B WITH A QUOTE IF IT IS A STRING
2307
002553
001000
000376
33900
CPI
34
;QUOTE SIGN?
2308
002554
000000
000042
2309 002555 001000
000312
33920
JZ
STRNG
IYES, GO TO SPECIAL STRING HANDLING
2310
002556
000000
002727
2311
002557
000000
002550
2312
002560
001000
000267
33940
ORA
A
;END OF LINE?
2313
002561
001000
000312
33960
JZ
CRDONE
IYES, DONE CRUNCHING
2314
002562
000000
002753
2315
002563
000000
002556
2316
33980
IFN
STRING,
2317
002564
001000
000072
34000
LDA
DORES
;IN DATA STATEMENT AND NO CRUNCH?
2318
002565
000000
001544
2319
002566
000000
002562'
2320
002567
001000
000267
34020
ORA
A
2321
002570
001000
000107
34040
MOV
B,A
;INITIALIZE RESERVED WORD COUNT
2322
002571
001000
000176
34060
MOV
A,M
;GET THE CHARACTER AGAIN
2323
002572'
001000
060302
34080
JNZ
STUFFH>
IIF NO CRUNCHING JUST STORE
2324
002573
000000
002667
2325
002574
000000
002565'
2326
34100
;THE CHARACTER
2327
34120
IFN
LENGTH,
<
NOT FOR 4K VERSION
2328
002575'
001000
000376
34140
CPI
"?"
iA QMARK?
2329
002576
000000
000077
2330
002577
001000
000076
34160
MVI
A,PRINTK
2331 002600 000000
000231
2332 002601 001000
000312
34180
JZ
STUFFH
,THEN USE A "PRINT" TOKEN
2333 002602' 000000
002667
2334 002603 000000
002573°
2335 002604 001000
060176
34200
MOV
A,M
2336 002605 001000
000376
34220
CPI
"0"
;SKIP NUMERICS
2337 002606 000000
000060
2338 002607 001000
000332
34240
JC
MUSTCR
;SINCE CRUNCHING IS SLOW
2339 002610 000000
002617
2340 002611 000000
002602
2341 002612' 001000 000376
34260
CPI
60
;":" ALSO PUT IN QUICKLY
2342 002613 000000 000674
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-9
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2343 002614 001000 000332
34280
JC
STUFFH
2344 002615 000000 002667
2345
002616
000000
002610
2346
002617
34300
MUSTCR:
>
2347
002617
001000
000325
34320
PUSH
D
;SAVE STORE POINTER
2348
34340
IFE
STRING,
<
2349
34360
MVI
8,07
;INIT RESERVED WORD COUNT
2350
002620 001000
000021
34380
LXI
D,RESLST-1
;INIT TO RESERVED WORD LIST
2351
002621 000000
000171
2352
002622' 000000
002615'
2353
002623 001000
000345
34400
PUSH
H
;SAVE IN BUF POINTER
2354
002624 001000
000076
34420
XWD
01000,-076
""MVI" AROUND CHRGET
2355
002625' 001000
000327
34440
NXTRES: CHRGET
;GET CHAR FROM LINE
2356 002626 001000
000023
34460
INX
D
;BUMP DEPOSIT POINTER
2357
002627 001000
000032
34480
RESER:
LDAX
D
IGET A BYTE FROM RESERVED WORD LIST
2358
002630 001000
000346
34560
ANI
127
;GET RID OF SIGN BIT
2359
002631 000000
000177
2360
002632 001000
000312
34520
JZ
TABEND
TEND OF RESERVED WORD TABLE
2361
002633 000000
002653
2362
002634 000000
002621
2363
002635' 001000
000276
34540
CMP
M
;TWO CHARS THE SAME?
2364
002636 001000
000302
34560
JNZ
NTHIS
INO, DIFFERENT
2365
002631 000000
002736
2366
002640 000000
002633'
2367
002641 001000
000032
34580
LOAX
D
;GET RESERVED WORD BYTE
2368
002642' 001000
000267
34600
ORA
A
:SET CONDITION CODES
2369
002643 001000
000362
34620
JP
NXTRES
I IF SIGN SET, RESERVED WORD FOUND
2370
002644 000000
002625
2371
002645 000000
002637
2372
002646 001000
000361
34640
FOUND:
POP
PSW
ITAKE OFF GARBAGE ORIG POINTER
2373
002647 001000
000170
34660
MOV
A,8
;GET RESERVED WORD
#
2374
002650 001000
000366
34680
ORI
128
;SET MSB TO FLAG AS RESERVED WORD
2375
002651 000000
000206
2376
002652' 001000
000362
34700
XWD
-01000, 0362
"JJ" AROUND THE POP H AND MOV A,M
2377
002653 001000
000341
34720
TABEND: POP
H
;GET BACK ORIG POINTER
2378
002654 001000
000176
34740
MOV
A,M
;GET BACK ORIG CHAR
2379
002655' 001000
000321
34760
POP
D
;GET STUFF POINTER BACK
2380
34780
IFE
LENGTH-2,
2381
002656 001000
000353
34800
XCHG
[H,L]=STUFF POINTER
2382
002657 001000
000376
34820
CPI
ELSETK
:HAVE TO PUT A HIDDEN
2383
002660 000000
000220
2384
34840
;COLON IN FRONT OF "ELSE"S
2385
002661 001000
000066
34860
MVI
M,":"
;STORE IT
2386
002662' 000000
000072
2387
002663 001000
000314
34880
CZ
INXHRT##
1ADVANCE POINTER ON "ELSE"
2388
002664 000000
000000*
2389
002665 000000
002644
2390
34900
iso ONLY ON "ELSE" THE COLON IS NOT OVERWRITTEN
2391
2392
002666 001000 000353
34920
XCHG>
; (D,E)=STUFF POINTER
2393
002667 001000 000043
34940
STUFFH: INX
H
;ENTRY TO BUMP [H,L]
2394
002670 001000 000022
34960
STAX
D
1SAVE CHARACTER IN CRUNCHED LINE
2395
002671 001000 000023
34980
INX
D
;BUMP SAVE POINTER
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 17(113) 03:12 10-SEP-75 PAGE 8-10
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2396
002672
001000
000014
35000
INR
C
;BUMP CRUNCHED CHARACTER COUNT
2397
35020
IFN
STRING,
2398
002673
001000
000326
35040
SUI
ISEE IF IT IS A COLON
2399 002674 000000 000072
2400
002675 001000
000312
35060
JZ
COLIS
;IF so ALLOW CRUNCHING AGAIN
2401
002676 000000
002705
2402
002677° 000000
002664
2403
002700 001000
000376
35080
CPI
DATATK-":"
2404
002701 000000
000111
2405 002702' 001000
000302
35100
JNZ
NODATT
;SEE IF IT IS A DATA TOKEN
2406 002703 000000
002710
2407
002704 000000
002676
2408
002705 001000
000062
35120
COLIS:
STA
DORES
;SETUP FLAG
2409
002706 000000
001544
2410
002707 000000
002703
2411
002710 001000
000326
35140
NODATT: SUI
REMTK-":">
2412
002711 000000
000124
2413
35160
IFE
STRING, <SUI
REMTK>
IWAS IT A REM STATEMENT
2414
002712' 001000
000302
35180
JNZ
KLOOP
IKEEP LOOPING
2415
002713 000000
002544
2416 002714* 000000
002706
2417 002715 001000
000107
35200
MOV
B,A
IREM DOESN'T STOP ON ":", ONLY ON A ZERO
2418 002716 001000
000176
35220
STR1:
MOV
A,M
;GET A CHAR
2419 002717 001000
000267
35240
ORA
A
;SET CONDITION CODES
2420
002720° 001000
000312
35260
JZ
CROONE
IIF END OF LINE THEN DONE
2421 002721 000000
002753
2422
002722' 000000
002713
2423 002723' 001000
000270
35280
CMP
B
IEND OF GOBBLE
2424 002724 001000
000312
35300
JZ
STUFFH
;IF YES, DONE WITH STRING
2425
002725' 000000
002667
2426
002726 000000
002721
2427
002727 001000
000043
35320
STRNG:
INX
H
;INCREMENT TEXT POINTER
2428
002730 001000
060022
35340
STAX
D
;STORE CHAR
2429
002731 001000
000014
35360
INR
C
;BUMP COUNT
2430
002732 001000
000023
35380
INX
D
;AND POINTER
2431
002733 001000
000303
35400
JMP
STR1
;KEEP LOOPING
2432
002734 000000
002716*
2433
002735' 000000
002725'
2434
2435
002736 001000
000341
35440
NTHIS:
POP
H
IRESTORE TEXT STRING
2436
002737
001000
000345
35460
PUSH
H
;AND SAVE IT BACK
2437
002740 001000
060604
35480
INR
8
;INCREMENT RESERVED WORD #
2438 002741 001000
000353
35500
XCHG
RESLST POINTER INTO [H,L
2439
002742 001000
000266
35520
NTHISI: ORA
M
ITEST BITS IN RESERVED WORD LIST
2440
002743 001000
000043
35540
INX
H
2441
002744 001000
000362
35560
JP
NTHISI
;SKIP MORE
2442 002745 000000
002742'
2443
002746 000000
002734
2444
002747 001000
000353
35580
XCHG
IRESLST POINTER INTO [D,E]
2445
35600
1TEXT POINTER INTO (H,L)
2446
002750
001000
060303
35620
JMP
RESER
IDONE, MOVE TO NEXT RESERVED WORD
2447
002751 000000
002627
2448
002752'
000000
002745
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47 (113) 03:12 10-SEP-75 PAGE 8-11
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2449 002753 001000 000641
35640 CROONE: LXI
,BUFMIN
ILEAVE WITH [H,L] POINTER TO START OF LINE
2450 002754 000000 001430
2451
002755
000000
002751
2452 002756 001000
000022
35660
STAX
D
INEED THREE 0's ON THE END
2453 002757 001000
000023
35680
INX
D
IONE FOR END-OF-LINE
2454
002760 001000
000022
35700
STAX
D
AND 2 FOR A ZERO LINK
2455
002761 001000
000023
35720
INX
D
;SINCE IF THIS IS A DIRECT STATEMENT
2456
002762' 001000
000022
35740
STAX
D
IITS END MUST LOOK LIKE THE END OF A PROGRAM
2457
002763 001000 000311
35760
RET
IEND OF CRUNCHING
2458
35780
;
2459
35800
THIS IS THE LINE INPUT ROUTINE
2460
35820
IT READS CHARACTERS INTO BUF USING AS THE
2461
35840
CHARACTER DELETE CHARACTER AND @ AS THE LINE DELETE CHARACTER
2462
35860
;
IF MORE THAN BUFLEN CHARACTER ARE TYPED, NO ECHOING
2463
35880
;
IS DONE UNTIL A
. OR CARRIAGE-RETURN IS TYPED.
2464
35900
; CONTROL-G WILL BE TYPED FOR EACH EXTRA CHARACTER.
2465
35920
;
THE ROUTINE IS ENTERED AT INLIN
2466
35940
;
2467 002764 001000 000005
35960
LINLIN: DCR
B
;BACK ARROW so DECREMENT COUNT
2468 002765' 001000 000053
35980
DCX
H
;BACK UP POINTER
2469
36000
IFN
REALIO,
2470
002766° 001000
000337
36020
OUTCHR>
2471
002767 001000
000302
36040
JNZ
INLINC
NOT TOO MANY so CONTINUE
2472
002770* 000000
003003
2473 002771 000000
002754
2474 002772'
36060
INLINN: IFN
REALIO,.
2475
002772' 001000
000337
36080
OUTCHR>
;PRINT THE @, OR A SECOND IF THERE
2476
36100
;WERE TOO MANY
2477
002775° 001000
000315
36120
CALL
CRDO
;TYPE A CRLF
2478 002774 000000
004523
2479 002775 000000
002170
2480 002776 001000
000041
36140
INLIN: LXI
H,BUF
2481 002777° 000000
001431
2482 003000 000000
002774*
2483 003001 001000
000006
36160
MVI
8,1
:CHARACTER COUNT
2484 003002 000000
000001
2485 003003 001000
000315
36180
INLINC: CALL
INCHR
;GET A CHARACTER
2486 003004 000000
003126
2487
003005 000000
002777°
2488
36182
IFN
LENGTH,
<
2489
003006
001000
000376
36184
CPI
7
;IS IT BOB ALBRECHT RINGING THE BELL
2490 003007 000000
000007
2491
003010
001000
000312
36186
JZ
GOODCH>
;FOR SCHOOL KIDS?
2492
003011
000000
003044
2493 003012 000000
003604
2494
003013 001000
000376
36200
CPI
13
;IS IT A CARRIAGE RETURN?
2495
003014 000000
000615
2496
003015 001000
000312
36220
JZ
FININL
;IF so FINISH UP
2497
003016 000000
004516
2498
003017° 000000
003011
2499
003020 001000
000376
36240
CPI
32
;CHECK FOR FUNNY CHARACTERS
2500
003021
000000
000046
2501
003022' 001000
000332
36260
JC
INLINC
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-12
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2502 003023 000000 003003
2503 003024 000000 003016
2504 003025 001000
000376
36280
CPI
125
2505 003026 000000
000175
2506 003027 001000
060322
36300
JNC
INLINC
;BIG ONES BAD TOO
2507 003030 000000
003003
2508
003031 000000
003023
2509 003032' 001000
000376
36320
CPI
"e"
ILINE DELETE?
2510 003033 000000
000100
2511 003034 001000
000312
36340
JZ
INLINN
2512 003035 000000
002772°
2513 003036 000000
003030
2514 003037 001000
000376
36360
CPI
"+"
:CHARACTER DELETE?
2515 003040 000000
060137
2516
003041 001000
000312
36380
JZ
LINLIN
2517
003042' 000000
002764°
2518 003043 000000
003035'
2519 003044 001000
000117
36400
GOODCH: MOV
C,A
2520
003045 001000
000170
36420
MOV
A,8
2521
003046 001000
000376
36440
CPI
BUFLEN
2522
003047 000000
000110
2523 003050 001000
000076
36460
MVI
A,7
;GET A BELL IN CASE LINE TOO LONG.
2524
003051 000000
000607
2525
003052 001000
000322
36480
JNC
OUTBEL
;LINE TOO LONG, RING BELL.
2526 003053 000000
003061
2527
003054 000000
003042'
2528
003055' 001000
000171
36500
MOV
A,C
2529
003056 001000
000161
36520
MOV
M,C
ISTORE THIS CHARACTER
2530 003057 001000
000043
36540
INX
H
.
2531 003060 001000
000004
36560
INR
B
2532
003061
36580
OUTBEL:
2533
36600
IFN
REALIO,<
2534 003061 001000 060337
36620
OUTCHR>
2535 003062 001000 000303
36640
JMP
INLING
2536 003063 000000 003003
2537 003064 000000 003053
2538
003065
36660
OUTCON:
2539
36680
IFN
CONTRW,
2540 003065 001000 000302
36700
JNZ
PPSWRT>
INO, DO OUTPUT
2541
003066 000000 010024
2542
003067 000000 063063
2543
36720
IFN
REALIO,
;MITS I/O
2544
36740
IFN
LPTSW,C
2545
36760
LDA
PRTFLG
ISEE IF WE WANT TO TALK TO LPT
2546
36780
ORA
A
ITEST BITS
2547
36800
JZ
TTYCHR
IF ZERO THEN NOT
2548
36820
POP
PSW
;GET CHARACTER WE WANT TO PRINT
2549
36840
PUSH
PSW
2550
36860
CPI
13
;IS IT CARRIAGE RETURN?
2551
36880
CZ
PRINTW
;FORCE OUT A LINE
2552
36900
JC
PPSWRT
;IF FUNNY CONTROL CHARACTER (LF) DO NOTHING
2553
36920
LDA
LPTPOS
;WHERE ARE WE?
2554
36940
CPI
LPTLEN
;AT THE END?
BASIC MCS 8080 GATES/ALLEN/DAVIDOF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-13
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2555
36960
CNC
PRINTW
EYES, START OVER
2556
36980
INR
A
2557
37000
STA
LPTPOS
2558
37020
LPTWAT: IN
2
2559
37040
ANI
2
2560
37060
JZ
LPTWAT
2561
37080
POP
PSW
2562
37100
OUT
3
;SEND OUT CHAR
2563
37120
RET
RETURN
2564
37140
PATLPT: BLOCK
20
2565
37160
FINLPT: XRA
A
RESET PRINT FLAG so OUTPUT
2566
37180
STA
PRTFLG
;GOES TO THE TERMINAL
2567
37200
LDA
LPTPOS
;SEE IF ANY LEFTOVERS MUST BE
2568
37220
ORA
A
;FORCED OUT
2569
37240
RZ
;BY LOOKING AT LPTPOS
2570
37260
PRINTW: IN
2
MAKE SURE LAST PRINT
2571
37280
ANI
2
1FINISHED BY TESTING DONE
2572
37300
JZ
PRINTW
;BIT
2573
37320
; SEE IF BUFFER MUST BE EMPTIED
2574
37340
LDA
LPTPOS
2575
37360
ORA
A
:CHARACTERS IN THE BUFFER?
2576
37380
JNZ
PRINTR
;IF so DON'T CLEAR THE BUFFER
2577
37400
MVI
A,4
;OTHERWISE BUFFER MUST BE EMPTIED
2578
37420
OUT
2
;CLEAR THE BUFFER
2579
37440
;TO PRINT A BLANK LINE
2580
37460
PRINTR: MVI
A,1
;TELL LPT TO PRINT
2581
37480
OUT
2
;STATUS REG
2582
37500
DCR
A
([A]=0
2583
37520
STA
LPTPOS
;RESET LINE PRINT POSITION
2584
37540
RET>
2585 003076
37560
TTYCHR:>
2586
37580
IFN
STRING,
2587 003070 001000 000361
37600
POP
PSW
IGET THE CHARACTER
2588 003071 001000 000365
37620
PUSH
PSW
;AND SAVE IT AGAIN
2589 003072' 001000 000376
37640
CPI
32
;IS THIS A MEANINGFUL CHARACTER?
2590 003075 000000 000640
2591 003074° 001000 060332
37660
JC
TRYOUT>
1IF IT'S A NON-PRINTING CHARACTER
2592 003075 000000 003113
2593 003076 000000 003066
2594
37680
100N'T INCLUDE IT IN TTYPOS
2595
37700
IFN
LENGTH!CONTRWILPTSW,<
2596 0030771 001000 060072
37720
LDA
TTYPOS>
ISEE IF PRINT HEAD IS AT THE END OF THE LINE
2597
003100 000000
000047
2598
003101
000000
003075
2599
37740
CPI
LINLEN
;MODIFIED BY "TERMINAL WIDTH?" QUESTION IN INIT
2600 003102' 001000 000376
2601
003105
000000
060110
2602
003103
37760
LINPTI ==:..1
2603 003104 001000 000314
37780
CZ
CRDO
;TYPE CRLF AND SET TTYPOS AND (A)= IF so
2604 003105 000000 004523
2605
003106
000000
003100
2606
003107
001000
000074
37800
INR
A
;INCREMENT TTYPOS SINCE WE'RE
2607
37820
;GOING TO PRINT A CHARACTER.
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-14
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2608 003110 001000 000062
37840
STA
TTYPOS
;STORE NEW PRINT HEAD POSITION
2609 003111 000000 000047
2610 003112 000000 003105'
2611
003113
37860
TRYOUT:
2612
37880
IFN
REALIO,<
2613
003113
001000
000333
37900
NOPRIN: IN
0
;GET STATUS
2614
003114
000000
000000
2615
003114
37920
CNLCA1
;CONSOLE COMMAND CHANGE LOC
2616
003115
001000
000346
37940
ANI
ODONE
10K TO SEND CHAR
2617 003116 000000
000206
2618
003117
001000
000302
37960
JNZ
NOPRIN>
;KEEP LOOPING
2619 003120 000000
003113
2620
003121 000000
003111'
2621
003122' 001000
000361
37980
POP
PSW
;GET CHARACTER BACK
2622
003123 001000
000323
38000
OUT
TTOCHN
;SEND OUT THE CHAR
2623
003124 000000
000601
2624
003124
38020
CNLCB1==.=1
;CONSOLE COMMAND CHANGE LOC
2625
003125 001000
000311
38040
RET
RETURN FROM OUTCHR
2626
2627
2628 003126
38100
INCHR:
IFN
REALIO, <
2629 003126 001000
000333
38120
TRYIN: IN
0
;GET STATUS
2630
003127 000000
060606
2631
003127
38140
CNLCA2== -1
;CONSOLE COMMAND CHANGE LOC
2632
003130
001000
000346
38160
ANI
IDONE
FEST BIT
2633
003131
000000
000001
2634
003132 001000
000302
38180
JNZ
TRYIN>
1GO BACK & DO IT AGAIN
2635
003133 000000
003126
2636
003134 000000
003120
2637
003135 001000
000333
38200
IN
TTICHN
IGET A CHAR
2638
003136 000000
060601
2639
003136
38220
CNLC82==
;CONSOLE COMMAND CHANGE LOC
2640
003137 001000
000346
38240
ANI
127
IGET RID OF PARITY BIT
2641
003140 000000
000177
2642
38260
IFN
CONTRW.
2643
003141
001000
000376
38280
CPI
CONTW
HIS IT SUPRESS OUTPUT?
2644
003142' 000000
000017
2645
003143 001000
000300
38300
RNZ
2646 003144 001000
000072
38320
LDA
CNTWFL
2647
003145 000000
001541
2648 003146 000000
003133'
2649
003147 001000
060057
38340
CMA
;COMPLEMENT ITS STATE
2650 003150 001000
060062
38360
STA
CNTWFL>
;SAVE BACK
2651
003151 000000
001541
2652
003152'
000000
003145'
2653
003153
001000
000311
38380
RET
2654
38400
PAGE
BASIC MCS 8086 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 9
F3
MAC
6-SEP-64 03:11
THE "LIST" COMMAND
2655
38420 SUBTTL THE "LIST" COMMAND
2656
2657
38460
IFN
LENGTH-2,<
2658
38480
IFN
LPTSW,.
2659
38500
LLIST:
MVI
A,1
;GET NON ZERO VALUE
2660
38520
STA
PRTFLG>
ISAVE IN I/O FLAG
2661
38540
LIST:
CALL
LINGET
;GET LINE NUMBER INTO [D,E]
2662
38560
RNZ
;MUST BE A TERMINATOR OR ERROR
2663
38580
POP
B
;GET RID OF NEWSTI RETURN ADDR
2664
38600
CALL
FNDLIN
;FIND LINE GREATER THAN OR EQUAL TO (D,E)
2665
38620
PUSH
8
;SAVE START POINTER
2666
38640
LIST4:
POP
H
;GET POINTER TO LINE
2667
38660
PUSHM
;PUSH LINK
2668
38680
POP
B
;TAKE OFF FOR A SECOND
2669
38700
MOV
A,8
;SEE IF END OF CHAIN
2670
38720
ORA
C
2671
38740
JZ
READY
2672
38760
IFN
LISTEN,
2673
38780
CALL
ISCNTC>
CHECK FOR CONTROL-C
2674
38800
PUSH
B
PUT BACK ON
2675
38820
CALL
CRDO
:00 CRLF TO START OUT
2676
38840
PUSHM
;PUSH LINE #
2677
38860
XTHL
;GET LINE # INTO [H,L]
2678
38880
;AND WE WANT [H,L] ON THE STACK
2679
38900
CALL
LINPRT
;PRINT AS INT WITOUT LEADING SPACE
2680
38920
MVI
A,
2681
38940
PRIT4:
POP
H
IRESTORE POINTER TO START OF TEXT
2682
38960
PLOOP:
OUTCHR
PALWAYS A SPACE AFTER THE LINE
2683
38980
MOV
A,M
;GET A CHARACTER FROM LINE.
2684
39000
ORA
A
;IS IT A RESERVED WORD
2685
39020
INX
H
;INCREMENT POINTER INTO TEXT
2686
39040
JZ
LIST4
IZERO, END OF LINE, GET NEXT LINE
2687
39060
JP
PLOOP
IREGULAR CHAR, JUST PRINT IT
2688
39080
SUI
127
;GET RID OF SIGN BIT AND ADD ONE
2689
39100
MOV
C,A
;GET RESERVED WORD # IN C
2690
39120
PUSH
H
;SAVE CURRRENT POSIT
2691
39140
LXI
RESLST
;GET RESLST POINTER.
2692
39160
RESRCH: PUSH
D
;SAVE
2693
39180
2694
39200
RESCRI: LDAX
D
;GET CHARACTER FROM RESLST
2695
39220
INX
D
;BUMP RESLST POINTER
2696
39240
ORA
A
ITEST BITS
2697
39260
JP
RESCRI
;NOT AT END OF RESERVED WORD YET
2698
39280
DCR
C
;DECREMENT CHAR
2699
39300
POP
H
1POP START POINTER HERE
2700
39320
JNZ
RESRCH
;NOT AT END OF RESLST YET.
2701
39340
;HERE WHEN FOUND RIGHT RESERVED
WORD
2702
39360
PRIT3:
MOV
A,M
;GET A CHARACTER FROM RESERVED WORD
2703
39380
ORA
A
ISET CONDITION CODES
2704
39400
JM
PRIT4
2705
39420
OUTCHR
2706
39440
INX
H
;BUMP RESLST POINTER
2707
39460
JMP
PRIT3>
;PRINT THE REST