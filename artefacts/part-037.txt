
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 18-1
F4
MAC
23-AUG-64 06:08
ARCTANGENT FUNCTION
4189
003231
000000
000301
69080
301
4190
003232'
000000
000057
69100
057
4191 003233 000000
000174
69120
174
4192 003234 000000
000164
69140
164
; .07528964
4193 003235' 000000
000661
69160
061
4194 003236 000000
000232
69180
232
4195 003237 000000
000175
69200
175
4196 003240 000000
000204
69220
204
, 1065626
4197 003241 000000
000675
69240
075
4198 003242' 000000
000132
69260
132
4199 003243 000000
000175
69280
175
4200 003244 000000
000310
69300
310
; ..142089
4201
003245 000000
000177
69320
177
4202 003246 000000
000221
69340
221
4203 003247 000000
000176
69360
176
4204
003250 000000
000344
69380
344
; 1999355
4205
003251 000000
000273
69400
273
4206 003252' 000000
000114
69420
114
4207 003253 000000
000176
69440
176
4208 003254 000000
000154
69460
154
, .3333315
4209
003255' 000000
000252
69480
252
4210 003256 000000
000252
69500
252
4211
003257 000000
000177
69520
177
4212 003260 000000
000000
69540
000
, 1.0
4213 003261 000000
000600
69560
000
4214
003262 000000
000000
69580
000
4215
003263
000000
000201
69600
201>
4216
69620
PAGE
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 19
F4
MAC
23-AUG-64 06:08
SYSTEM INITIALIZATION CODE
4217
69640 SUBTTL SYSTEM INITIALIZATION CODE
4218
69660
RADIX
10
;IN ALL NON-MATH PACKAGE CODE
4219
69680
;THIS IS THE SYSTEM INITIALIZATION CODE
4220
69700
IIT SHOULD BE LOADED AT THE END OF THE BASIC
4221
69720 :INTERPRETER
4222
4223
69760
INTERNAL
INIT
4224
4225
69800
EXTERNAL
CRDO,LINGET,QINLIN,READY,SCRTCH,STROUT,REASON,BUF
4226
69820
EXTERNAL
SNERR,OMERR,ILLFUN
4227
4228
145040
69860
FUNIO==<*0256**0312>+-040+SCODE
4229
003264
69880
INITSA: BLOCK
10
4230
003276 001000
000041
69900
INITAT: LXI
H, AUTTXT
4231
003277 000000
004035
4232 003300 000000
003214
4233 003301 001000 000315
69920
CALL
STROUT
4234 003302' 000000 001763*
4235 003305 000000
003277°
4236
003304
69940
INIT:
4237
69960
IFN
REALIO,
<
4238
003304 001000
000333
69980
IN
1
IGNORE GARBAGE CHARACTER IN INTERFACE
4239 003305* 000000
000001
4240 003306 001000
000333
70000
IN
0255
;SEE WHAT KIND OF I/O HE IS
4241 003307 000000
000377
4242 003310 001000
000346
70020
ANI
0100
IIS HE FUNNY TTY?
4243
003311 000000
000100
4244 003312' 001000
000312
70040
JZ
NOTSIO
4245 003315 000000
003343
4246 003314 000000
003302'
4247 003315' 001000
000041
70060
LXI
H,FUNIO
4248 003316 000000
145040*
4249
003317° 000000
003313
4250
003320 001000
000042
10080
SHLO
CNLCA2##+2
4251 003321 000000
000002*
4252
003322' 000000
003316
4253 003323' 001000
000646
70100
MVI
1,0310
4254
003324 000000
000310
4255 003325' 001000
000042
70120
SHLD
CNLCA3##+2
4256 003326 000000
000002*
4257
003327 000000
003321
4258
70140
IFN
LENGTH,
4259 003330 001000
000046
70160
MVI
H,-0304
;SUBSTITUE "CNZ"
4260 003331 000000
000304
4261 003332' 001000
000042
70180
SHLD
CNLCA4##+2>
4262 003333' 000000
000002*
4263 003334 000000
003326°
4264
145002
70200
FUNIO==SCODE+<-0256**0312>+2
4265 003335' 001000
000041
10220
LXI
H,FUNIO
4266 003336 000000
145002*
4267
003337
000000
003333*
4268
003340 001000
000042
70240
SHLD
CNLCA1##+2
4269
003341
000000
000002*
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 19-1
F4
MAC
23-AUG-64 06:08
SYSTEM INITIALIZATION CODE
4270
003342
000000
063336
4271
003343
001000
000333
10260
NOTSIO: IN
0255
4272 003344* 000000
000377
4273 003345 001000
000346
70280
ANI
-040
4274 003346 000000
000040
4275 003347 001000
000312
70300
JZ
NOTPIO
4276
003350 000000
003400
4277
003351 000000
003341
4278
145002
70320 FUNIO=SCODE+<"0256**0312>+2
4279
003352' 001000
000041
70340
LXI
H,FUNIO
4280
003353 000000
145002*
4281 003354 000000
003350
4282 003355' 001000
000042
70360
SHLD
CNLCA2+2
4283 003356' 000000
000002*
4284 003357 000000
003353
4285 003360* 001000
000046
70380
MVI
1,0010
4286 003361' 000000
000310
4287 003362' 001000
000042
70400
SHLD
CNLCA3+2
4288 003363 000000
000002*
4289
003364 000000
003356
4290
70420
IFN
LENGTH,
<
4291
003365 001000
000646
70440
MVI
0304
4292 003366 000000
000304
4293 003367 001000
000042
70460
SHLD
CNLCA4+2>
4294 003370 000000
000002*
4295 003371' 000000
003363'
4296
145001
70480
FUNIO=SCODE+<-0256**0312>+1
4297
003372 001000
000041
10500
LXI
H,FUNIO
4298 003373 000000
145001*
4299 003374 000000
003370
4300 003375 001000
060642
10520
SHLD
CNLCA1+2
4301 003376 000000
000002*
4302
003377'
000000
003373
4303 003400
70540
NOTPIO:>
4304 003400 001000
000041
10560
LXI
H,SCODE+*065535
4305 003401 000000
177777*
4306 003402' 000000
003376
4307 003403 001000
000642
70580
SHLD
CURLIN##
IN CASE OF ERROR MESSAGE
4308 003404 000000
000000*
4309 003405 000000
003401
4310 003406 001000
000041
70600
LXI
HSTACK
ISET UP TEMP STACK
4311 003407 000000
004315
4312 003410* 000000
003404
4313 003411 001000
000371
70620
SPHL
4314 003412 001000
000042
70640
SHLD
STKTOP##
4315 003413 000000
000000*
4316 003414 000000
003407
4317
70660
IFN
CONTRW,
<
4318 003415 001000
000257
70680
XRA
A
4319 003416 001000 000062
70700
STA
CNTWFL##>
4320 003417 000000 000000*
4321 003420' 000000 003413
4322
003421
001000
000315
70720
CALL
CRDO
;TYPE A CR
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 19-2
F4
MAC
23-AUG-64 06:08
SYSTEM INITIALIZATION CODE
4323
003422'
000000
000000*
4324
003423'
000000
003417
4325
70740
IFN
STRING,
4326 003424 001000
000041
70760
LXI
H, TEMPST##
4327 003425' 000000
000000*
4328 003426 000000
003422'
4329 003427 001000
000042
70780
SHLD
TEMPPT##>
4330 003430 000000
000000*
4331 003431 000000
003425'
4332
70800
IFN
REALIO,
4333 003432' 001000
000041
70820
LXI
H,MEMORY
PASK HOW MUCH MEMORY AVAILABLE
4334 003433 000000
004243
4335 003434 000000
003430°
4336 003435' 001000
000315
70840
CALL
STROUT
;CALL THE STRING PRINTER
4337 003436 000000
003302*
4338 003437 000000
003433'
4339 003440 001000
000315
70860
CALL
QINLIN
;GET A LINE OF INPUT
4340 003441 000000
000000*
4341 003442 000000
003436
4342 003443 001000
000327
70880
CHRGET
;GET A CHAR
4343 003444 001000
000376
70900
CPI
HAN
4344 003445 000000
000101
4345 003446 001000
000312
70920
JZ
INITAT
4346 003447 000000
003276
4347 003450 000000
003441
4348 003451 001000
000267
70940
QRA
A
4349 003452' 001000
060302
70960
JNZ
USEDE9
INON ZERO, DONT USE DEFAULT
4350 003453' 000000
003501
4351 003454 000000
003447
4352 003455' 001000
000041
70980
LXI
H,LASTWR
4353 003456' 000000
004257
4354
003457 000000
003453*
4355
003466 001000
000043
71000
LOOPMM: INX
H
4356
003461 001000
000076
71020
MVI
A,311
4357
003462 000000
000467
4358
003463 001000
000167
71040
MOV
M,A
4359
003464 001000
000276
71060
CMP
M
4360
003465 001000
000302
71080
JNZ
USEDEF
4361
003466 000000
003515'
4362 003467* 000000
003456
4363
003470 001000
000075
71100
DCR
A
4364 003471 001000
000167
71120
MOV
M,A
4365
003472' 001000
000276
71140
CMP
M
4366 003473 001000
000312
71160
JZ
LOOPMM
4367
003474 000000
003460
4368 003475 000000
003466'
4369 003476 001000
000303
71180
JMP
USEDEF
4370 003477* 000000
003515'
4371 003500 000000
003474
4372 003501 001000
000041
71200
USEDE9: LXI
H,BUF
4373
003502
000000
000000
4374
003503
000000
003477°
4375 003504 001000
000315
71220
CALL
LINGET
IGET DECIMAL AMOUNT OF MEMORY IN (D,E)
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 19-3
F4
MAC
23-AUG-64 06:08
SYSTEM INITIALIZATION CODE
4376
003505'
000000
000000
4377 003506 000000
003502'
4378 003507 001000 000267
71240
ORA
A
4379 003510 001000
000302
71260
JNZ
SNERR
IMAKE SURE HE HAS A TERMINATOR
4380
003511
000000
000000*
4381 003512' 000000
003505
4382 003515* 001000
000353
71280
XCHG
4383
003514
001000
000053
71300
DCX
H
4384
003515
001000
000053
71320
USEDEF: DCX
H>
4385
71340
IFE
REALIO,<
4386
71360
LX1
,SCODE+16190>
4387
003516 001000
000345
71380
PUSH
H
;ALSO SAVE FOR LATER
4388
003517 001000
000041
71400
TTYW:
LXI
H,TTYWIO
4389 003520 000000
004127'
4390 003521 000000
003511*
4391
003522 001000
000315
71420
CALL
STROUT
4392 003523' 000000
003436*
4393 003524 000000
003520
4394 003525' 001000
000315
71440
CALL
QINLIN
4395 003526 000000
003441*
4396 003527 000000
003523
4397 003530 001000
000327
71460
CHRGET
4398 003531 001000
000267
71480
ORA
A
4399 003532' 001000
000312
71500
JZ
DFLENT
4400 003533 000000
003604
4401 0035349 000000
003526
4402 003535' 001000
000041
71520
LXI
H,BUF
4403 003536 000000
003502*
4404 003537* 000000
003533
4405 003540 001000
000315
71540
CALL
LINGET
4406 003541 000000
003505*
4407 003542' 000000
003536
4408 003543 001000
000172
71560
MOV
A,O
4409 003544 001000
000267
71580
QRA
A
4410 003545' 001000
000302
71600
JNZ
TTYW
4411 003546 000000
003517
4412 003547 000000
003541
4413 003550 001000
000173
71620
MOV
A,E
4414 003551 001000
000376
71640
CPI
16
4415 003552 000000
000020
4416 003553 001000
000332
71660
JC
TTYW
4417 003554* 000000
003517
4418 003555' 000000
003546
4419 003556 001000
000062
71680
STA
LINPT1##
DECLARE LINPT1 EXTERNAL
4420 003557* 000000
000000*
4421 003560 000000
003554'
4422
71700
IFN
LENGTH,
4423 003561 001000 000062
71720
STA
LINPT2##>
4424 003562' 000000 000000*
4425 003563 000000 003557
4426
71740
IFN
STRING,
4427 003564 001000 000062
71760
STA
LINPT3##>
4428 003565' 000000 000000*
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOPF MACRO 47(113) 06:09 27-AUG-75 PAGE 19-4
F4
MAC
23-AUG-64 06:08
SYSTEM INITIALIZATION CODE
4429
003566
000000
003562'
4430 003567 001000 000326
71780
MORCPS: SUI
14
4431 003570 000000
000016
4432 0035719 001000
000322
71800
JNC
MORCPS
4433 003572' 000000
0035679
4434 0035739 000000
003565'
4435 003574 001000
000306
71820
ADI
28
4436 003575' 000000
000034
4437 003576 001000
000057
71840
CMA
4438 003577° 001000
000074
71860
INR
A
4439 003600 001000
000203
71880
ADD
E
4440 003601 001000
000062
71900
STA
LINPT4##
4441 003602' 000000
000000*
4442 003603 000000
003572'
4443 003604
71920
DFLENT:
4444
71940
IFN
STRING,
1SET UP DEFAULT STRING SPACE
4445 003604 001000
000021
71960
LXI
D,SCODE+ 065536 "050+1
4446 003605 000000
177717*
4447 003606 000000
003602
4448 003607 001000
000341
71980
POP
H
4449 003610 001000
000042
72000
SHLD
MEMSIZ##
;SAVE IN REAL MEMORY SIZE
4450 003611 000000
000000*
4451 003612 000000
003605'
4452 003613 001000
000042
72020
SHLD
PRETOP##
1STRINGS START FROM HERE DOWN
4453 003614 000000
000000*
4454 0036159 000000
003611
4455 003616 001000
000031
72040
DAD
D
;CALC STRBOT BY SUBTRACTING 200 FROM STKTOP
4456 003617 001000
000322
72060
JNC
OMERR
MUST BE POSITIVE
4457 003620 000000
000000*
4458 003621 000000
003614
4459 003622' 001000
000053
72080
DCX
H
;ONE LOWER IS STKTOP
4460
003623* 001000
000345
72100
PUSH
H>
;SAVE IT ON STACK
4461
72120
IFE
EXTENC,
4462
72140
4463
72160
;
FUNCTION DELETION ROUTINE FOR 4K MACHINE
4464
72180
,
TO ADD A NEW FUNCTION JUST UPDATE TBLDO
4465
72200
4466
72220
ASKAGN: LXI
TBLDO
;START OF FUNCTION TABLE
4467
72240
LOPASK: PUSHM
;PUT ON CANDIDATE FOR START OF FREE MEMORY
4468
72260
LXI
D, ,TBDASK
100NE ASKING?
4469
72280
COMPAR
4470
72300
JZ
FINFUN
EYES, GET FIRST FREE MEM LOC
4471
72320
INTO (0,E) AND QUIT
4472
72340
PUSHM
;PUT ON MESSAGE LOCATION
4473
72360
XTHL
; CH,LI =MESSAGE POINTER
4474
72380
;POINTER INTO TBLDO GOES ON THE STACK
4475
72400
CALL
STROUT
;PRINT THE MESSAGE
4476
72420
CALL
QINLIN
ISEE WHAT ME HAS TO SAY
4477
72440
CHRGET
ISEE WHAT THE FIRST CHARACTER OF INPUT WAS
4478
72460
POP
H
;POP OFF POINTER INTO TBLDO
4479
72480
CPI
HYH
4480
72500
FINFUN: POP
D
;POP OFF CANDIDATE FOR START OF
4481
72520
;FREE MEMORY
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 19-5
F4
MAC
23-AUG-64 06:08
SYSTEM INITIALIZATION CODE
4482
72540
JZ
HAVFNS
THE WANTS IT SO WE ARE DONE
4483
72560
CPI
"N"
;IF A BAD ANSWER
4484
72580
JNZ
ASKAGN
IMAKE HIM START OVER
4485
72600
PUSHM
;PUSH ON FUNCTION CALL
4486
72620
;LOCATION THAT WE FIX UP
4487
72640
XTHL
ICH,L)=FIXUP PLACE
4488
72660
;POINTER INTO TBLDO GOES ON THE STACK
4489
72680
LXI
0, ,ILLFUN
,THIS IS WHAT WE STORE
4490
72700
MOV
M,E
4491
72720
INX
H
4492
72740
MOV
M,D
4493
72760
POP
H
;GET TBLDO POINTER
4494
72780
JMP
LOPASK>
;GQ ASK AGAIN FOR ANOTHER FUNCTION
4495
72800
IFN
EXTENC,
4496
003624
001000
000041
12820
ASKAGN: LXI
H,FNS
PASK IF WANTS SIN, COS, ATN.
4497
003625
000000
004010
4498
003626
000000
003620
4499 003627 001000
000315
72840
CALL
STROUT
;THE STRING
4500 003630 000000
003523*
4501 003631 000000
003625'
4502 003632' 001000
060315
72860
CALL
QINLIN
4503 003633' 000000
003526*
4504 003634 000000
003630
4505 003635' 001000
000327
72880
CHRGET
4506 003636 001000
060376
72900
CPI
"Y"
4507 003637 000000
000131
4508 003640 001000
000021
72920
LXI
D,INITSA
ASSUME NOT DELETE ANY FNS
4509 003641 000000
003264
4510 003642' 000000
003633
4511 003643 001000
000312
72940
JZ
HAVENS
;YUP,
4512 003644 000000
003712'
4513 003645 000000
003641
4514 003646 001000
000376
12960
CPI
"A"
4515 003647 000000
000101
4516 003650 001000
000312
72980
JZ
OKCHAR
4517 003651 000000
003660
4518 003652' 000000
003644
4519 003653 001000
000376
73000
CPI
"N"
4520 003654 000000
000116
4521 003655' 001000
000302
73020
JNZ
ASKAGN
4522 003656 000000
003624
4523 003657 000000
003651
4524 003660 001000
000041
73040
OKCHAR: LXI
H,ILLFUN
;MAKE SURE BOMBS IF TRIES TO CALL THEM
4525 003661 000000
000000*
4526 003662 000000
003656
4527 003663 001000
000621
73060
LXI
D,ATN
4528 003664 000000
003152
4529 003665 000000
003661
4530 003666 001000
000042
73080
SHLO
ATNFIX##
4531 003667 000000
000000*
4532 003670 000000
003664
4533 003671 001000
000376
73100
CPI
"A"
IDELETE ATN BUT NOT SIN, COST
4534
003672
000000
000101
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 19-6
F4
MAC
23-AUG-64 06:08
SYSTEM INITIALIZATION CODE
4535
003673
001000
000312
73120
JZ
HAVENS
ITEST
4536
003674
000000
003712'
4537
003675
000000
003667
4538 003676 001000
000042
73140
SHLD
COSFIX##
4539 003677 000000
000000*
4540 003700 000000
003674
4541 003701 001000
000042
73160
SHLD
TANFIX##
4542 003702 000000
000000*
4543 003703 000000
003677
4544 003704 001000
000042
73180
SHLD
SINFIX##
4545 003705 000000
000000*
4546 003706 000000
003702'
4547 003707 001000
000021
73200
LXI
D,COS>
4548 003710 000000
002762'
4549 003711 000000
003705
4550 003712'
73220
HAVENS:
;TEXT ALWAYS PRECEDED BY ZERO
4551 003712 001000
000353
73240
XCHG
;PUT BOTTOM OF MEMORY IN (H,L)
4552 0037139 001000
000066
73260
MVI
M,0
;STORE IT
4553 003714 000000
000600
4554 003715 001000
000043
73280
INX
H
INCREMENT POINTER
4555 003716 001000
000042
73300
SHLD
TXTTAB##
;SAVE BOTTOM OF MEMORY
4556 003717 000000
000000*
4557 003720* 000000
003710
4558 003721 001000
000343
73320
XTHL
4559 003722' 001000
000021
73340
LXI
,TSTACK
4560 003723 000000
004315
4561 003724 000000
003717
4562 003725 001000
000347
73360
COMPAR
4563 003726 001000
000332
73380
JC
OMERR
4564 003727 000000
003620*
4565 003730 000000
003723
4566 003731 001000
000321
73400
POP
D
4567 003732' 001000
000371
73420
SPHL
4568 003733 001000
000042
73440
SHLD
STKTOP
4569 003734 000000
003413*
4570 003735 000000
003727
4571 003736 001000
000353
73460
XCMG
4572 003737 001000
000315
73480
CALL
REASON
4573 003740 000000
000000*
4574 003741 000000
003734
4575 003742' 001000
000175
73500
MOV
A,E
;SUBRACT VARTAB FROM STKTOP
4576 003743 001000
060225
73520
SUB
,LOW PART
4577 003744 001000
000157
73540
MOV
L.A
,
4578 003745 001000
000172
73560
MOV
A,O
HIGH PART
4579 003746 001000
000234
73580
SBB
H
;
4580 003747 001000
000147
73600
MOV
H,A
ILEAVE IN (8,C)
4581 003750 001000
000601
73620
LXI
B,SCODE+65520
4582 003751 000000
177760*
4583 003752' 000000
003740
4584 003753 001000
000011
73640
DAD
8
4585 003754 001000 000315
73660
CALL
CROO
ITYPE CRLF
4586 003755' 000000 003422*
4587
003756
000000
003751