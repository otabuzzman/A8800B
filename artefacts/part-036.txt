
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUGe75 PAGE 16
F4
MAC
23-AUG-64 06:08
POLYNOMIAL EVALUATOR AND THE RANDOM NUMBER GENERATOR
3804
63900 SUBTTL POLYNOMIAL EVALUATOR AND THE RANDOM NUMBER GENERATOR
3805
63920
IFN
EXTENC,
3806
63940
;EVALUATE P(X-2)**
3807
63960
;POINTER TO DEGREE+1 IS IN (HL)
3808
63980
;THE CONSTANTS FOLLOW THE DEGREE
3809
64000
;CONSTANTS SHOULD BE STORED IN REVERSE ORDER, FAC HAS X
3810
64020
;WE COMPUTE:
3811
64040
;
(N)
(2*N+1)
3812 002613 001000 000315
64060
POLYX:
CALL
PUSHF
;SAVE X
3813 002614 000000
001205
3814 002615 000000
002550
3815 002616 001000
000021
64080
LXI
D,FMULTT
IPUT ADDRESS OF FMULTT ON STACK so WHEN WE
3816 002617 000000
000515
3817 002620 000000
002614
3818 002621 001000
000325
64100
PUSH
D
; RETURN WE WILL MULTIPLY BY X
3819 002622' 001000
000345
64120
PUSH
H
ISAVE CONSTANT POINTER
3820 002623 001000
000315
64140
CALL
MOVRF
;SQUARE X
3821 002624 000000
001240
3822 002625* 000000
002617
3823 002626 001000
000315
64160
CALL
FMULT
3824 002627 000000
000517
3825 002630 000000 002624
3826 002631 001000 000341
64180
POP
H
;GET CONSTANT POINTER
3827
64200
;FALL INTO POLY
3828
3829
3830
64260
;POLYNOMIAL EVALUATOR
3831
64280
;POINTER TO DEGREE+1 IS IN (HL), IT IS UPDATED
3832
64300
;THE CONSTANTS FOLLOW THE DEGREE
3833
64320
;CONSTANTS SHOULD BE STORED IN REVERSE ORDER, FAC HAS X
3834
64340
IWE COMPUTE:
3835
64360
, CO+C1*X+C2*X*2+C3*X*3+
3836
002632' 001000
000315
64380
POLY:
CALL
PUSHF
ISAVE X
3837
002633 000000
001205'
3838
002634 000000
002627
3839 002635' 001000
000176
64400
MOV
A,M
;GET DEGREE
3840 002636* 001000
000643
64420
INX
H
;INCREMENT POINTER TO FIRST CONSTANT
3841 002637 001000
000315
64440
CALL
MOVFM
;MOVE FIRST CONSTANT TO FAC
3842 002640 000000
001222'
3843 002641 000000
002633'
3844 002642' 001000
000606
64460
XWD
1000,006
,"MVI 8" OVER NEXT BYTE
3845 002643 001000
000361
64480
POLY1:
POP
PSW
IGET DEGREE
3846 002644 001000
000301
64500
POPR
;GET X
3847 002645 001000
000321
3848 002646 001000
000075
64520
DCR
A
;ARE WE DONE?
3849 002647 001000
000310
64540
RZ
IYES, RETURN
3850 002650 001000
000325
64560
PUSHR
INO, SAVE X
3851 002651 001000
000305
3852 002652 001000
000365
64580
PUSH
PSW
ISAVE DEGREE
3853 002653' 001000
000345
64600
PUSH
H
;SAVE CONSTANT POINTER
3854
002654 001000
000315
64620
CALL
FMULT
EVALUATE THE POLY, MULTIPLY BY X
3855 002655 000000 000517
3856
002656
000000
002640
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 16-1
F4
MAC
23-AUG-64 06:08
POLYNOMIAL EVALUATOR AND THE RANDOM NUMBER GENERATOR
3857 002657 001000 000341
64640
POP
H
;GET LOCATION OF CONSTANTS
3858 002660 001000 000315
64660
CALL
MOVRM
;GET CONSTANT
3859 002661 000000 001243
3860 002662' 000000 002655'
3861
64680
PUSH
H
;STORE LOCATION OF CONSTANTS so FADD AND FMULT
3862 002663 001000 000345
3863 0026649 001000 000315
64700
CALL
FADD
, WILL NOT SCREW THEM UP, ADD IN CONSTANT
3864 002665' 000000 000025'
3865 002666 000000 002661
3866 002667 001000 000341
64720
POP
H
;MOVE CONSTANT POINTER TO NEXT CONSTANT
3867 002670 001000 000303
64740
JMP
POLY1>
ISEE IF DONE
3868 002671 000000 002643
3869
002672' 000000 002665
3870
3871
3872
64800
;PSUEDO-RANDOM NUMBER GENERATOR
3873
64820
;IF ARG=0, THE LAST RANDOM NUMBER GENERATED IS RETURNED
3874
64840
1IF ARG .LT. 0, A NEW SEQUENCE OF RANDOM NUMBERS IS STARTED
3875
64860
,
USING THE ARGUMENT
3876
64880
;TO FORM THE NEXT RANDOM NUMBER IN THE SEQUENCE, WE MULTIPLY THE
3877
64900
;PREVIOUS RANDOM NUMBER BY A RANDOM CONSTANT, AND ADD IN ANOTHER
3878
64920
;RANDOM CONSTANT. THEN THE HD AND LO BYTES ARE SWITCHED, THE
3879
64940
: EXPONENT IS PUT WHERE IT WILL BE SHIFTED IN BY NORMAL, AND THE
3880
64960
;EXPONENT IN THE FAC SET TO 200 so THE RESULT WILL BE LESS THAN 1.
3881
64980
;THIS IS THEN NORMALIZED AND SAVED FOR THE NEXT TIME.
3882
65000
;THE HO AND LO BYTES WERE SWITCHED so WE HAVE A RANDOM CHANCE OF
3883
65020
;GETTING A NUMBER LESS THAN OR GREATER THAN 5
3884
002675
65040
RND:
3885
65060
IFN
LENGTH-2,
3886
002675 001000 000357
65080
FSIGN>
IGET SIGN OF ARG
3887
65100
IFE
LENGTH-2,
3888
65120
CALL
VSIGN
;GET THE SIGN OF THE ARG
3889
65140
PUSH
PSW
:SAVE THE SIGN
3890
65160
CM
FRCSNG
IIF IT IS NEGATIVE, FORCE IT TO BE A SNG
3891
65180
MVI
A,4
, SINCE WE WILL USE IT
3892
65200
STA
VALTYP
;MAKE SURE THE RESULT IS "SINGLE PRECISION"
3893
65220
POP
PSW>
IGET THE SIGN BACK
3894
0026747
001000
000372
65240
JM
RND1
START NEW SEQUENCE IF NEGATIVE
3895
0026751
000000
002725'
3896 002676 000000
002671
3897 0026779 001000 000041
65260
LXI
H,RNDX
;GET LAST NUMBER GENERATED
3898 002706 000000 002752'
3899 002701 000000
002675'
3900 002702' 001000 000315
65280
CALL
MOVFM
3901 002703 000000 001222'
3902 002704 000000 002700
3903 002705' 001000 000310
65300
RZ
RETURN LAST NUMBER GENERATED IF ZERO
3904
65320
IFE
EXTENC,
3905
65340
CALL
FMULTS>
;MULTIPLY BY CONSTANT A
3906
65360
IFN
EXTENC,
3907
002706 001000 000315
65380
CALL
MOVRM
3908
002707 000000 001243
3909 002710 000000 002703
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 16-2
F4
MAC
23-AUG-64 06:08
POLYNOMIAL EVALUATOR AND THE RANDOM NUMBER GENERATOR
3910 002711 001000 000315
65400
CALL
FMULT>
3911 002712' 000000
000517
3912 002713 000000
002707
3913 002714 001000
000001
65420
MOVRI
150,050,261,106 ;ADD IN CONSTANT OF ORDER 2"(-24)
3914 002715 000000
000050
3915 002716 000000
000150
3916 002717 001000
000621
3917 002720 000000
000106
3918 0027219 000000
000261
3919 002722' 001000
000315
65440
CALL
FADD
3920 002723 000000
000025
3921 002724 000000
002712'
3922 002725' 001000
000315
65460
RND1
CALL
MOVRF
;SWITCH HO AND LO BYTES,
3923 002726 000000
001240
3924 002727 000000
002723'
3925 002730 001000
000173
65480
MOV
A,E
;GET LO
3926 0027319 001000
000131
65500
MOV
E,C
;PUT HO IN LO BYTE
3927 002732 001000
000117
65520
MOV
C,A
;PUT LO IN HO BYTE
3928 002733' 001000
000066
65540
MVI
M,200
;MAKE RESULT POSITIVE
3929 002734 000000
000200
3930 002735 001000
000053
65560
DCX
H
;GET POINTER TO EXPONENT
3931 002736 001000
000106
65580
MOV
8,M
;PUT EXPONENT IN OVERFLOW POSITION
3932 002737 001000
000666
65600
MVI
M,200
ISET EXP so RESULT WILL BE BETWEEN 0 AND 1
3933 002740 000000
060200
3934 002741 001000
000315
65620
CALL
NORMAL
;NORMALIZE THE RESULT
3935 002742 000000
000146
3936 002743 000000
002726
3937 002744 001000
000041
65640
LXI
H,RNDX
SAVE RANDOM NUMBER GENERATED FOR NEXT
3938 002745' 000000
002752'
3939 002746 000000
002742'
3940 002747 001000
000303
65660
JMP
MOVMF
; TIME
3941 002750 000000
001254
3942
002751 000000
002745*
3943
3944
65700
:CONSTANTS AND STORAGE FOR RND
3945
002752 000000
000122
65720
RNDX:
122
ILAST RANDOM NUMBER GENERATED, BETWEEN 0 AND 1
3946 002753 000000
000307
65740
307
3947 002754 000000
000117
65760
117
3948 002755' 000000
000200
65780
200
3949 002756 000000
000172
65800
172
;RANDOM NUMBER OF ORDER 2*24
3950 002757 000000
000104
65820
104
3951
002760° 000000
000065
65840
065
3952
002761 000000
060230
65860
230
3953
65880
PAGE
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 17
F4
MAC
23-AUG-64 06:08
SINE, COSINE AND TANGENT FUNCTIONS
3954
65900
SUBTTL SINE, COSINE AND TANGENT FUNCTIONS
3955
65920
IFN
EXTENC,<
3956
65940
;COSINE FUNCTION
3957
65960
;IDEA: USE (X) #SINCX+PI/2)
3958 002762' 001000 000041
65980
COS:
LXI
PI2
PADD PI/2 TO FAC
3959 002763 000000 003070
3960 002764 000000 002750
3961 002765 001000 000315
66000
CALL
FADDS>
3962 002766 000000 000003
3963 002767 000000 002763
3964
66020
;FALL INTO SIN
3965
3966
3967
66080
;SINE FUNCTION
3968
66100
;IDEA: USE IDENTITIES TO GET FAC IN QUADRANTS I OR IV
3969
66120
;THE FAC IS DIVIDED BY 2*PI AND THE INTEGER PART IS IGNORED BECAUSE
3970
66140
ISIN(X+2*PI)=SIN(X). THEN THE ARGUMENT CAN BE COMPARED WITH PI/2 BY
3971
66160
;COMPARING THE RESULT OF THE DIVISION WITH PI/2/(2PI)1/4,
3972
66180
;IDENTITIES ARE THEN USED TO GET THE RESULT IN QUADRANTS I OR IV.
3973
66200
;AN APPROXIMATION POLYNOMIAL IS THEN USED TO COMPUTE INCX).
3974 002770 001000 000315
66220
SIN:
CALL
PUSHF
IDIVIDE FAC BY 2*PI
3975 002771 000000
001205
3976 002772' 000000
002766
3977 002773 001000
000001
66240
MOVRI
203,111,017,333 1AFTER DIVIDING BY 2*PI, RESULT IS
3978 002774* 000000
000111
3979 002775* 000000
060203
3980 002776* 001000
000021
3981 002777 000000
000333
3982 003000 000000
000017
3983 003001 001000
000315
66260
CALL
MOVER
, BETWEEN 0 AND 1
3984 003002' 000000
001225'
3985 003003 000000
002771
3986 003004 001000
000301
66280
POPR
3987 003005' 001000
000321
3988 003006 001000
060315
66300
CALL
FDIV
3989 003007 000000
000655'
3990 003010 000000
003002'
3991 003011 001000
000315
66320
CALL
PUSHF
IDISREGARD INTEGER PART SINCE SIN
3992 003012' 000000
001205
3993 003013 000000
003007
3994 003014* 001000
000315
66340
CALL
INT
; IS PERIODIC WITH PERIOD 2*PI
3995 003015 000000
001445
3996 003016 000000
003012'
3997 003017 001000
000301
66360
POPR
3998 003020 001000
000321
3999 003021 001000
060315
66380
CALL
FSUB
4000
003022' 000000 000017
4001
003023 000000 003015
4002
66400
IFE
EXTENC,
4003
66420
LXI
8,177*400+SCODE ;GET 1/4
4004
66440
MOV
D,C
4005
66460
MOV
E,C
4006
66480
CALL
FSUB>
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 17-1
F4
MAC
23-AUG-64 06:08
SINE, COSINE AND TANGENT FUNCTIONS
4007
66500
IFN
EXTENC, <
4008 003024 001000
060041
66520
LXI
H,FR4
ISEE WHAT QUADRANT WE ARE IN
4009 003025' 000000
003074*
4010 003026 000000
003022'
4011 003027 001000
000315
66540
CALL
FSUBS>
4012 003030 000000
000011
4013 003031 000000
003025
4014 003032' 001000
000357
66560
FSIGN
.
4015 003033 001000
000067
66580
STC
;SET QUADRANT I FLAG
4016 003034 001000
000362
66600
JP
SIN1
FIRST QUADRANT, GET BACK ORIGINAL X
4017 003035 000000
003044*
4018 003036 000000
003030
4019 003037 001000
000315
66620
CALL
FADDH
;ADD 1/2
4020 003040 000000
000000
4021 003041 000000
003035
4022 003042 001000
000357
66640
FSIGN
4023 003043 001000
000267
66660
ORA
A
CLEAR CARRY
4024 003044 001000
000365
66680
SIN1:
PUSH
PSW
;SAVE QUADRANT FLAG
4025
003045 001000
000364
66700
CP
NEG
INEGATE IF IN QUADRANTS I, II OR III
4026 003046 000000
001175'
4027
003047
000000
003040
4028
66720
IFE
EXTENC,<
4029
66740
LXI
,177*400+SCODE ;GET 1/4
4030
66760
MOV
D,C
4031
66780
MOV
E,C
4032
66800
CALL
FADD>
4033
66820
IFN
EXTENC,<
4034 003050 001000 000041
66840
LXI
H,FR4
;ADD 1/4, IN QUADRANTS II, III
4035
003051
000000
003074
4036
003052
000000
003046
4037
66860
, USE THE IDENTITY: SIN(PI-X)=SIN(X)
4038
66880
JIN QUADRANT IV, USE THE IDENTITY:
4039 003053 001000 000315
66900
CALL
FADDS>
;
SIN(X-2*PI)=SIN(X)
4040 003054 000000
000003
4041 003055' 000000
003051
4042 003056 001000 000361
66920
POP
PSW
,GET QUADRANT FLAG
4043 003057 001000 000324
66940
CNC
NEG
NEGATE IF IN QUADRANTS II, III OR IV
4044 003060 000000 001175
4045 003061 000000 063054
4046
66960
IFE
EXTENC,
EVALUATE APPROXIMATION POLYNOMIAL
4047
66980
CALL
PUSHF
SAVE X
4048
67000
CALL
MOVRF
;SQUARE X
4049
67020
CALL
FMULT
4050
67040
CALL
PUSHF
ISAVE X-2
4051
67060
LXI
,SINCON
4052
67080
CALL
MOVEM
;MOVE FIRST CONSTANT INTO FAC
4053
67100
POPR
IGET X*2
4054
67120
MVI
A,4
IGET DEGREE
4055
67140
POLY 1:
PUSH
PSW
;SAVE DEGREE
4056
67160
PUSHR
ISAVE X*2
4057
67180
PUSH
H
1SAVE CONSTANT POINTER
4058
67200
CALL
FMULT
EVALUATE THE POLY, MULTIPLY BY X*2
4059
67220
POP
H
;GET POINTER TO CONSTANTS
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 17-2
F4
MAC
23-AUG-64 06:08
SINE, COSINE AND TANGENT FUNCTIONS
4060
67240
CALL
MOVRM
IGET CONSTANT
4061
67260
PUSH
H
;SAVE POINTER
4062
67280
CALL
FADD
IADD IN CONSTANT
4063
67300
POP
H
;MOVE POINTER TO NEXT CONSTANT
4064
67320
POPR
IGET X*2
4065
67340
POP
PSW
;GET DEGREE
4066
67360
DCR
A
ISEE IF DONE
4067
67380
JNZ
POLY1
INO, DO NEXT TERM
4068
67400
JMP
FMULTI>
MULTIPLY BY X AND WE ARE DONE
4069
67420
IFN
EXTENC,
4070
003062' 001000
000041
67440
LXI
H,SINCON
:CALCULATE THE SIN BY EVALUATING
4071
003063 000000
003100
4072 003064 000000 003060
4073
003065 001000
000303
67460
JMP
POLYX>
; THE APPROXIMATION POLYNOMIAL
4074
003066' 000000
002613
4075 003067 000000
003063
4076
67480
;CONSTANTS FOR SIN, COS
4077
67500
IFN
EXTENC, <
4078 003070 000000
000333
67520
PI2:
333
; PI/2
4079 003071 000000
000017
67540
017
4080 003072 000000
000111
67560
111
4081 003073 000000
000201
67580
201
4082 003074 000000
000000
67600
FR4:
000
, 1/4
4083 003075' 000000
000000
67620
000
4084 003076 000000
000000
67640
000
4085 003077 000000
000177
67660
177>
4086 003100
67680
SINCON:
4087
67700
IFN
EXTENC,
4088 003100 000000
000005
67720
5>
;DEGREE
4089 003101 000000
000272
67740
272
; 39,701067
4090 003102 000000
000327
67760
327
4091 003103 000000
000036
67780
036
4092 003104 000000
000206
67800
206
4093 003105' 000000
000144
67820
144
; -76.57498
4094 003106 000000
000046
67840
046
4095 003107 000000
000231
67860
231
4096 003110 000000
000207
67880
207
4097 003111 000000
000130
67900
130
; 81,60223
4098 003112' 000000
000064
67920
064
4099 003113* 000000
000043
67940
043
4100 003114* 000000
000207
67960
207
4101 003115* 000000
000340
67980
340
; -41.34168
4102 003116 000000
000135
68000
135
4103 003117 000000
000245
68020
245
4104 003120* 000000
000206
68040
206
4105 003121 000000
000332
68060
332
; 6,283185
4106 003122' 000000
000017
68080
017
4107 003123 000000
000111
68100
111
4108
003124 000000
000203
68120
203
4109
4110
4111
68180
IFN
EXTENC,
4112
68200
;TANGENT FUNCTION
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 17-3
F4
MAC
23-AUG-64 06:08
SINE, COSINE AND TANGENT FUNCTIONS
4113
68220
;TAN =SINC /COS (X)
4114 003125' 001000
000315
68240
TAN:
CALL
PUSHF
;SAVE ARG
4115 003126' 000000
001205'
4116 003127' 000000
063066
4117 003130 001000
000315
68260
CALL
SIN
; TAN(X)=SIN(X)/COS(X)
4118 003131 000000
002770
4119 003132' 000000
003126
4120 003133 001000
000301
68280
POP
B
;GET X OFF STACK
4121 003134 001000
000341
68300
POP
H
;PUSHF SMASHES (DE)
4122 003135' 001000
000315
68320
CALL
PUSHF
4123 003136 000000
001205
4124 003137' 000000
003131'
4125
003140' 001000
000353
68340
XCMG
IGET LO'S WHERE THEY BELONG
4126 003141 001000
000315
68360
CALL
MOVER
4127 003142' 000000
001225'
4128 003143 000000
003136
4129 0031447 001000
000315
68380
CALL
COS
4130 003145' 000000
002762
4131 003146 000000
003142'
4132 003147 001000
000303
68400
JMP
FDIVT>
4133
003150
000000
000653
4134
003151
000000
003145
4135
68420
PAGE
MATHPK FOR BASIC MCS 8080 GATES/ALLEN/DAVIDOFF MACRO 47(113) 06:09 27-AUG-75 PAGE 18
F4
MAC
23-AUG-64 06:08
ARCTANGENT FUNCTION
4136
68440
SUBTTL ARCTANGENT FUNCTION
4137
68460
IFN
EXTENC,<
4138
68480
;IDEA: USE IDENTITIES TO GET ARG BETWEEN 0 AND 1 AND THEN USE AN
4139
68500
;APPROXIMATION POLYNOMIAL TO COMPUTE ARCTAN(X)
4140
003152' 001000
000357
68520
ATN:
FSIGN
ISEE IF ARG IS NEGATIVE
4141
003153
001000
000374
68540
CM
PSHNEG
;IF ARG IS NEGATIVE, USE:
4142
003154
000000
002340
4143 003155' 000000
003150
4144 003156 001000
000374
68560
CM
NEG
,
ARCTAN (x) ==ARCTAN(-X)
4145 0031579 000000
001175'
4146 003160 000000
003154
4147 003161 001000
000872
68580
LDA
FAC
;SEE IF FAC ,GT. 1
4148 003162' 000000
002467*
4149 003163 000000
003157
4150 003164 001000
000376
68600
CPI
201
4151 003165' 000000
000201
4152 003166 001000
000332
68620
JC
ATN2
4153 003167 000000
003205
4154 003170 000000
003162'
4155 003171 001000
000001
68640
LXI
8,201*400+SCODE ;GET THE CONSTANT 1
4156 003172 000000
100400*
4157 003173 000000
003167
4158 003174 001000
000121
68660
MOV
D,C
4159 003175 001000
000131
68680
MOV
E,C
;COMPUTE RECIPROCAL TO USE THE IDENTITY:
4160 003176 001000
000315
68700
CALL
FDIV
, ARCTAN(X)=PI/2-ARCTAN(1/X)
4161 003177' 000000
000655'
4162 003200 000000
003172
4163 003201 001000
000041
68720
LXI
H,FSUBS
;PUT FSUBS ON THE STACK so WE WILL RETURN
4164 003202' 000000
000011'
4165 003203 000000
003177°
4166 003204 001000
000345
68740
PUSH
H
, TO IT AND SUBTRACT THE REULT FROM PI/2
4167 003205 001000
000041
68760
ATN2:
LXI
,ATNCON
EVALUATE APPROXIMATION POLYNOMIAL
4168 003206 000000
003217
4169 003207 000000
003202'
4170 003210 001000
000315
68780
CALL
POLYX
4171 003211 000000
002613
4172 003212' 000000
003206
4173 003213 001000
000041
68800
LXI
H,P12
;GET POINTER TO PI/2 IN CASE WE HAVE TO
4174 003214 000000
003070
4175 003215 000000
003211
4176 003216 001000
000311
68820
RET
, SUBTRACT THE RESULT FROM PI/2
4177
4178
68860
;CONSTANTS FOR ATN
4179 003217 000000
000011
68880
ATNCON: 11
;DEGREE
4180 003220* 000000
000112
68900
112
i 002866226
4181 003221 000000
000327
68920
327
4182 003222' 000000
000073
68940
073
4183 003223 000000
000170
68960
170
4184 003224 000000
000002
68980
002
; -.01616574
4185 003225' 000000
000156
69000
156
4186 003226* 000000 000204
69020
204
4187 003227 000000 000173
69040
173
4188 003230 000000 000376
69060
376
; .04290961