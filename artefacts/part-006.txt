
BASIC MCS 8080 GATES/ALLEN/DAVIDOF
MACRO (113) 03:12 10-SEP-75 PAGE 8
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
1866
27860 SUBTTL ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
1867
27880
IFN
LENGTH,
1868
002064
001000
000052
27900 DATSNE: LHLD DATLIN
;GET DATA LINE
1869
002065' 000000
001577
1870
002066
000000
002062'
1871
002067
001000
000042
27920
SHLD
CURLIN>
;MAKE IT CURRENT LINE
1872 002070 000000
001607
1873
002071 000000
002065
1874 002072 001000
000636
27940
SNERR: MVI
E,ERRSN
"SYNTAX ERROR"
1875 002073' 000000
000002
1876 002074 001000
000001
27960
XWD
01000.1
" LXI B, " OVER THE NEXT 2
1877 002075' 001000
000036
27980
DVDERR: MVI
E,ERROVO
;DIVISION BY ZERO
1878
002076
000000
000013
1879
28000
IFN
LENGTH,
1880
002077
001000
000601
28020
XWD
01000,1
;SKIP NEXT TWO
1881
002100° 001000
000036
28040
NFERR:
MVI
E,ERRNF>
I"NEXT WITHOUT FOR" ERROR
1882
002101
000000
000001
1883
002102'
001000
000315
28060
ERROR:
CALL
STKINI
PRESET THE STACK AND FLAGS
1884
002103
000000
002470
1885
002104
000000
002070
1886
28080
IFN
CONTRA,
<
1887
002105
001000
000257
28100
XRA
A
1888
002106 001000
000062
28120
STA
CNTWFL>
;FORCE OUTPUT
1889
002107
000000
001541
1890
002110
000000
002103
1891
002111'
001000
000315
28140
CALL
CRDO
;CRLF
.
1892
002112'
000000
004523
1893
002113
000000
002107
1894 002114 001000
000041
28220
LXI
H,ERRTAB
IGET START OF ERROR TABLE
1895 002115' 000000
000730
1896
002116
000000
002112'
1897
28240
IFE
LENGTH-2,
1898
002117'
001000
000315
28260
LEPSKP: CALL
REM
ISKIP AN ERROR MESSAGE
1899 002120' 000000
004074
1900 002121' 000000
002115'
1901 002122' 001000
000035
28280
DCR
E
;DECREMENT ERROR COUNT
1902
002123 001000
000043
28282
INX
H
ISKIP OVER THIS ERROR MESSAGE
1903
002124 001000
000302
28300
JNZ
LEPSKP>
;SKIP SOME MORE
1904
002125' 000000
002117
1905
002126
000000
002120
1906
28320
IFN
LENGTH-2,
1907
28322
MOV
D,A
;GET ZERO INTO D
1908
28324
MVI
A,"?"
;START OF ERROR MESSAGE
1909
28326
OUTCHR
;TYPE IT
1910
28340
DAD
D
ADD IN ERROR CODE
1911
28360
MOV
A,M
;GET FIRST ERROR CHARACTER
1912
28380
OUTCHR
ITYPE IT
1913
28400
CHRGET
IGET 2ND CHARACTER OF ERROR CODE
1914
28420
OUTCHR
TYPE IT
1915
28440
LXI
H,ERR>
;GET POINTER TO ERROR"
1916 002127' 001000 000315
28460
ERRFIN: CALL
STROUT
ITYPE IT
1917 002130 000000 007743
1918 002131' 000000 002125'
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-1
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
1919
002132
001000
000052
28480
LHLO
CURLIN
;CURRENT LINE #
1920 002133 000000 001607
1921 002134 000000 002130
1922 002135 001000 000174
28500
MOV
A,H
ISEE IF IN DIRECT MODE
1923 002136 001000 000245
28520
ANA
L
1924 002137 001000 080074
28540
INR
A
IZERO SAYS DIRECT MODE
1925 002140 001000 000304
28560
CNZ
INPRT
1PRINT LINE NUMBER IN (H,L)
1926
002141
000000
000000*
1927
002142 000000 002133
1928
28580
IFE
LENGTH,
1929
28600
XWD
01000,1
1"LXI 8, OVER THE NEXT 2
1930
28620
END:
1931
28640
STOP:
RNZ
;MAKE SURE HE TERMINATED IT
1932
28660
STPEND: POP
B
;GET RID OF "NEWSTT" RETURN ADDRESS
1933
28680
ENDCON:>
1934
28682
IFE
LENGTH-2,<
1935
28684
;
1936
28686
FOR "LIST" COMMAND STOPPING
1937
28688
;
1938
002143 001000 000076
28690
XWD
01000,000
;SKIP THE NEXT BYTE
1939
002144 001000 000301
28692
STPRDY: POP
8>
1940
28700
READY:
IFN
LPTSW,<
1941
28720
CALL
FINLPT>
;PRINT ANY LEFT OVERS
1942
28740
IFN
CONTRW,
1943
002145
001000
000257
28760
XRA
1944
002146
001000
000062
28780
STA
CNTWFL>
;FORCE OUTPUT
1945
002147
000000
001541
1946
002150
000000
002141
1947
002151
001000
000641
28800
LXI
H,SCODE+65535
1948 002152' 000000
177777°
1949 002153 000000
002147
1950 002154 001000
000042
28820
SHLD
CURLIN
ISETUP CURLIN FOR DIRECT MODE
1951 002155 000000
001607
1952 002156 000000
002152'
1953 002157 001000
000041
28840
LXI
H,REDDY
1"READY" CRLF CRLF
1954
002160 000000
001725'
1955
002161 000000
002155'
1956 002162' 001000
000315
28860
REPINI: CALL
INIT
;PRINT IT, REPLACED BY CALL STROUT
1957 002163 000000
000002*
1958
002164 000000
002160
1959
28880
BY THE INIT CODE. THIS IS HERE so AFTER
1960
28900
JERRORS DURING INIT, INIT IS RESTARTED
1961
002165 001000
000315
28920
MAIN:
CALL
INLIN
;GET A LINE FROM TTY
1962
002166 000000
002776
1963 002167 000000
002163
1964 002170 001000
000327
28940
CHRGET
;GET THE FIRST
1965 002171 001000
000074
28960
INR
A
;SEE IF 0 SAVING THE CARRY FLAG
1966 002172 001000
000075
28980
DCR
A
1967 002175 001000
000312
29000
JZ
MAIN
;IF so, A BLANK LINE WAS INPUT
1968 002174 000000
002165'
a
1969
002175'
000000
002166
1970
002176
001000
000365
29020
PUSH
PSW
SAVE STATUS INDICATOR FOR 1ST CHARACTER
1971 002177° 001000 000315
29040
CALL
LINGET
;READ IN A LINE #
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-2
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
1972
002200
000000
003642'
1973
002201
000000
002174
1974 002202' 001000 000325
29060
PUSH
D
;SAVE LINE
#
1975 002203 001000
000315
29080
CALL
CRUNCH
;CRUNCH THE LINE DOWN
1976 002204 000000
002533
1977 002205 000000
002200
1978 002206 001000
000107
29100
MOV
B,A
IA=0 AFTER CRUNCH, (8,C)=CHAR COUNT FOR NODEL
1979 002207 001000
000321
29120
POP
D
IRESTORE LINE
#
1980 002210 001000
000361
29140
POP
PSW
IWAS THERE A LINE #?
1981 002211' 001000
000322
29160
JNC
GONE
;IF NOT ITS A DIRECT STATEMENT
1982 002212' 000000
003370
1983 002213 000000
002204
1984 002214 001000
060325
29180
PUSH
D
1985 002215' 001000
000305
29200
PUSH
B
;SAVE LINE # AND CHARACTER COUNT
1986 002216 001000
000327
29220
CHRGET
REMEMBER IF THIS LINE IS
1987 002217 001000
000365
29240
PUSH
PSW
BLANK so WE DON'T INSERT IT
1988 002220 001000
000315
29260
CALL
FNOLIN
;GET A POINTER TO THE LINE
1989 002221 000000
002371
1990 002222' 000000
002212'
1991
002223' 001000
000305
29280
PUSH
B
1SAVE THE POINTER
1992
29300
IFE
LENGTH-2,
1993 002224 001000 000334
29320
CC
DEL>
IDELETE THE LINE
1994 002225' 000000 011271
1995
002226 000000
002221
1996
29340
IFN
LENGTH-2,
1997
29360
JNC
NODEL
INO MATCH so DON'T DELETE
1998
29380
XCHG
(D,E) NOW HAS THE POINTER TO THE LINE
1999
29400
;BEYOND THIS ONE
2000
29420
LHLD
VARTAB
;COMPACTIFYING TO VARTAB
2001
29440
MLOOP:
LDAX
D
2002
29460
STAX
B
;SHOVING DOWN TO ELIMINATE A LINE
2003
29480
INX
8
2004
29500
INX
D
2005
29520
COMPAR
2006
29540
JNC
MLOOP
IDONE COMPACTIFYING?
2007
29560
MOV
H,B
2008
29580
MOV
L.C
2009
29600
INX
H
;NEW VARTAB
2010
29620
SHLD
VARTAB>
2011
002227
001000
000321
29640
NODEL:
POP
0
;POP POINTER AT PLACE TO INSERT
2012
002230
001000
000361
29660
POP
PSW
;SEE IF THIS LINE HAD
2013
29680
;ANYTHING ON IT
2014 002231 001000 000312
29700
JZ
FINI
IIF NOT DON'T INSERT
2015
002232' 000000
002276
2016 002233' 000000
002225'
2017 002234 001000
060052
29720
LHLD
VARTAB
;CURRENT END
2018 002235' 000000
001621
2019 002236 000000
002232
2020 002237 001000
000343
29740
XTHL
; (H,L) =CHARACTER COUNT. VARTAB
2021
29760
;ONTO THE STACK
2022 002240 001000 000301
29780
POP
B
=OLD VARTAB
2023 002241 001000 000011
29800
DAD
8
2024
002242' 001000 000345
29820
PUSH
H
1SAVE NEW VARTAB
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-3
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2025 002243 001000 060315
29840
CALL
BLTU
2026 002244* 000000 002005
2027 002245 000000 002235'
2028 002246 001000
000341
29860
POP
H
IPOP OFF VARTAB
2029 002247 001000
060642
29880
SHLD
VARTAB
JUPDATE VARTAB
2030
002250 000000
001621
2031 002251 000000
002244
2032 002252' 001000 000353
29900
XCHG
2033 002253 001000 000164
29920
MOV
M,H
;FOOL CHEAD WITH NON-ZERO LINK
2034 002254' 001000 060643
29940
INX
H
ISO IT DOESN'T THINK
2035
29960
;THIS LINK IS THE
2036
29980
TEND OF THE PROGRAM
2037 002255 001000 000043
30000
INX
H
2038 002256 001000 000321
30020
POP
D
;GET LINE # OFF STACK
2039 002257 001000 000163
30040
MOV
M,E
2040 002260° 001000 060043
30060
INX
H
IPUT DOWN LINE #
2041 002261 001000 000162
30080
MOV
M,D
2042 002262 001000 060043
30100
INX
H
2043
2044
002263 001000
000021
30140
LXI
D,BUF
;MOVE LINE FROM BUF TO PROGRAM AREA
2045 002264 000000 001431
2046 002265 000000
002250
2047 002266* 001000 000032
30160
MLOOPR: LDAX
D
;NOW TRANSFERING LINE
2048
30180
;IN FROM BUF
2049
002267
001000
000167
30200
MOV
M,A
2050 002270° 001000
000043
30220
INX
H
2051 002271 001000
000023
30240
INX
D
2052 002272 001000
000267
30260
ORA
A
IZERO MARKS THE END
2053 002273 001000
000302
30280
JNZ
MLOOPR
2054 002274 000000
002266
2055 002275' 000000
002264
2056 002276 001000 000315
30300
FINI:
CALL
RUNC
100 CLEAR & SET UP STACK
2057 002277 000000 002437
2058 002300' 000000 002274
2059
30320
FALSO SETS [H,L] TO (TXTTAB)-
2060
002301 001000 000043
30340
INX
H
2061
30360
2062
30380
CHEAD GOES THROUGH PROGRAM STORAGE AND FIXES
2063
30400
;
UP ALL THE LINKS. THE END OF EACH
2064
30420
; LINE IS FOUND BY SEARCHING FOR THE ZERO AT THE END.
2065
30440
;
THE DOUBLE ZERO LINK IS USED TO DETECT THE END OF THE PROGRAM
2066
30460
;
2067 002302 001000 060124
30480
CHEAD:
MOV
D,H
2068 002303 001000 000135
30500
MOV
E,L
2069 002304 001000 000176
30520
MOV
A,M
ISEE IF END OF CHAIN
2070 002305 001000 000043
30540
INX
H
;BUMP POINTER
2071 002306 001000 060266
30560
ORA
M
12ND BYTE
2072 002307 001000 000312
30580
JZ
MAIN
IDONE
2073 002310 000000 002165
2074 002311 000000 002277'
2075 002312' 001000 000043
30600
INX
H
IFIX H TO START OF TEXT
2076
002313
001000
000043
30620
INX
H
2077 002314 001000 000043
30640
INX
H
BASIC MCS 8086 SATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-4
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2078 002315 001000 000257
30660
XRA
A
;SEARCHING FOR A ZERO IN MEMORY
2079 002316 001000 000276
30680
CZLOOP: CMP
M
ITO MARK THE END OF THIS LINE
2080 002317 001000 000043
30700
INX
H
;BUMP POINTER
2081 002320° 001000 000302
30720
JNZ
CZLOOP
TEND OF LINE
2082 002321 000000
002316
2083 002322' 000000
002310
2084 002323' 001000
060353
30740
XCHG
;SWITCH TEMP
2085 002324 001000
000163
30760
MOV
M,E
100 FIRST BYTE OF FIXUP
2086 002325 001000
000043
30780
INX
H
;ADVANCE POINTER
2087 002326 001000
000162
30800
MOV
M,D
12ND BYTE OF FIXUP
2088 002327 001000
000353
30820
XCHG
;AND BACK AGAIN
2089 002330 001000
000303
30840
JMP
CHEAD
;KEEP CHAINING TIL DONE
2090
002331 000000 002302'
2091
002332'
000000
002321
2092
30860
IFE
LENGTH-2,
2093
30880
2094
30900
;
SCNLIN SCANS A LINE RANGE OF
2095
30920
THE FORM #-# OR # OR #- OR -# OR BLANK
2096
30940
;
AND THEN FINDS THE FIRST LINE IN THE RANGE
2097
30960
;
2098
002333' 001000
000021
30980
SCNLIN: LXI
D,SCODE
;ASSUME START LIST AT ZERO
2099
002334 000000
000000
2100
002335 000000
062331
2101 002336 001000
000325
31000
PUSH
D
;SAVE INITIAL ASSUMPTION
2102 002337 001000
000312
31020
JZ
ALLLST
;IF FINISHED, LIST IT ALL
2103 002340 000000
002354
2104 002341 000000
002334
2105 002342 001000
000321
31040
POP
D
IWE ARE GOING TO GRAB A #
2106 002343 001000
000315
31060
CALL
LINGET
IGET A LINE #. IF NONE, RETURNS ZERO
2107 002344 000000
003642'
2108 002345' 000000
062346
2109 002346 001000
000325
31080
PUSH
D
;SAVE FIRST
2110 002347° 001000
000312
31100
JZ
ONELIN
1IF ONLY # THEN DONE.
2111 002350 000000
002365
2112 002351 000000
002344
2113 002352' 001000
000317
31120
SYNCHK
MINUTK
;MUST BE A DASH,
2114 002353' 000000
000251
2115 002354 001000
000021
31140
ALLLST: LXI
D,SCODE+-06552 ;ASSUME MAX END OF RANGE
2116 002355' 000000
177771
2117 002356 000000
002350
2118 002357 001000
000304
31160
CNZ
LINGET
IGET THE END OF RANGE
2119 002360 000000
003642'
2120 002361 000000
002355'
2121 002362' 001000
000302
31180
JNZ
SNERR
;MUST BE TERMINATOR
2122 002363 000000
002072
2123 002364 000000
002366
2124 002365' 001000
060353
31200
ONELIN: XCHG
;(H,L) = FINAL
2125 002366 001000 000321
31220
POP
D
;GET INITIAL IN (D,E)
2126 002367 001000 000343
31240
XTHL
;PUT MAX ON STACK, RETURN ADDR TO (H,L)
2127
002370 001000 000345
31260
PUSH
H>
;SAVE RETURN ADDRESS BACK
2128
31280
2129
31300
:
FNOLIN SEARCHES THE PROGRAM TEXT FOR THE LINE
2130
31320
WHOSE LINE # IS PASSED IN [D,E], (0,E) IS PRESERVED.
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 7(113) 03:12 10-SEP-75 PAGE 8-5
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2131
31340
THERE ARE THREE POSSIBLE RETURNS:
2132
31360
2133
31380
1) ZERO FLAG SET. CARRY NOT SET. LINE NOT FOUND.
2134
31400
NO LINE IN PROGRAM GREATER THAN ONE SOUGHT.
2135
31420
[B,C POINTS TO TWO ZERO BYTES AT END OF PROGRAM.
2136
31440
(H,L)=(8,C)
2137
31460
2138
31480
2) ZERO, CARRY SET.
2139
31500
(B,C) POINTS TO THE LINK FIELD IN THE LINE
2140
31520
WHICH IS THE LINE SEARCHED FOR.
2141
31540
(H,L) POINTS TO THE LINK FIELD IN THE NEXT LINE.
2142
31560
2143
31580
3) NON-ZERO, CARRY NOT SET.
2144
31600
LINE NOT FOUND, (8,C) POINTS TO LINE IN PROGRAM
2145
31620
GREATER THAN ONE SEARCHED FOR.
2146
31640
(H,L) POINTS TO THE LINK FIELD IN THE NEXT LINE.
2147
31660
2148 002371 001000 000052
31680
ENDLIN: LHLD
TXTTAB
;GET POINTER TO START OF TEXT
2149 002372 000000 001617
2150 002373' 000000 002363
2151 002374 001000 000104
31700
LOOP:
MOV
B,H
;IF EXITING BECAUSE OF END OF PROGRAM,
2152
31720
;SET (B,C) TO POINT TO DOUBLE ZEROES.
2153 002375 001000 000115
31740
MOV
C,L
2154 002376 001000
000176
31760
MOV
A,M
;GET WORD POINTER TO
2155 002377 001000 000043
31780
INX
H
;BUMP POINTER
2156 002400 001000
000266
31800
ORA
M
;GET 2ND BYTE
2157 002401 001000
000053
31820
DCX
H
IGO BACK
2158 002402 001000
000310
31840
RZ
IF ZERO THEN DONE
2159 002403 001000
000305
31860
PUSH
B
2160 002404 001000
000367
31880
PUSHM
;PUSH LINK
2161 002405 001000
000367
31900
PUSHM
;PUSH BINARY LINE #
2162 002406 001000
000341
31920
POP
H
1POP HERE
2163 002407 001000
060347
31940
COMPAR
;COMPARE [D,E) TO [H,L]
2164 002410 001000
000341
31960
POP
H
IGET LINK
2165 002411 001000
060301
31980
POP
B
;GET POINTER TO THIS LINE IN (B,C)
2166 002412' 001000
000077
32000
CMC
;TURN CARRY ON
2167 002413 001000
000310
32020
RZ
EQUAL RETURN
2168 002414 001000
000077
32040
CMC
;MAKE CARRY ZERO
2169 002415 001000
000320
32060
RNC
INO MATCH RETURN (GREATER)
2170 002416 001000 000303
32080
JMP
LOOP
IKEEP LOOPING
2171 002417 000000 002374
2172 002420 000000 002372'
2173
32100
2174
32120
;
THE "NEW" COMMAND CLEARS THE PROGRAM TEXT AS WELL
2175
32140
;
AS VARIABLE SPACE
2176
32160
;
2177 002421 001000 000300
32180
SCRATH: RNZ
;MAKE SURE THERE IS A TERMINATOR
o
2178
002422' 001000 000652
32200
SCRTCH: LHLD
TXTTAB
2179
0024237 000000 001617
2180
002424 000000 002417
c
2181
32220
IFN
LENGTH-2,
2182
32240
XRA
A>
2183
32260
IFE
LENGTH-2,
-
BASIC MCS 8080 GATES/ALLEN/DAVIDOFK
MACRO (113) 03:12 10-SEP-75 PAGE 8-6
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2184 002425 001000 000315
32280
CALL
TUFF>
;TURN OFF TRACE, SET (A) =0.
2185 002426 000000
003605'
2186 002427 000000 002423'
2187 002430 001000
000167
32300
MOV
M,A
;SAVE AT END OFF TEXT
2188 002431 001000
000043
32320
INX
H
1BUMP POINTER
2189 002432° 001000
000167
32340
MOV
M,A
;SAVE ZERO
2190 002433 001000
000043
32360
INX
H
;BUMP POINTER
2191
002434 001000
000042
32380
SHLD
VARTAB
NEW START OF VARIABLE
2192 002435 000000 001621
2193 002436 000000 002426
2194
32400
IFE
LENGTH,
2195
32420
RUN:
RNZ>
;CHECK FOR A TERMINATOR
2196 002437 001000 000052
32440
RUNC:
LHLD
TXTTAB
;POINT AT THE START OF TEXT
2197 002440 000000 001617
2198 002441 000000 002435'
2199
002442' 001000 000053
32460
DCX
H
2200
32480
2201
32500
CLEARC IS A SUBROUTINE WHICH INITIALIZES THE VARIABLE AND
2202
32520
ARRAY SPACE BY RESETING ARYTAB (THE END OF SIMPLE VARIABLE SPACE)
2203
32540
AND STREND (THE END OF ARRAY STORAGE), IT FALLS INTO STKINI
2204
32560
,
WHICH RESETS THE STACK. [H,L] IS PRESERVED.
2205
32580
;
2206
32600
IFE
STRING, <CLEAR:>
2207 002443 001000 000042
32620
CLEARC: SHLD
TEMP
ISAVE (H,L) IN TEMP
2208 002444 000000 001603
2209 002445 000000 002440
2210
32640
IFN
STRING,<
2211 002446 001000 000052
32660
LHLD
MEMSIZ
2212 002447 000000
001545
2213 002450 000000
002444
2214 002451 001000
000042
32680
SHLD
FRETOP>
;FREE UP STRING SPACE
2215 002452' 000000
001573
2216 002453' 000000
002447
2217 002454 001000
000315
32700
CALL
RESTORE
IRESTORE DATA
2218 002455 000000
003446
2219 002456 000000
002452'
2220 002457 001000
000052
32720
LHLD
VARTAB
;GET START OF VARIABLE SPACE
2221 002460 000000
001621
2222 002461 000000
002455'
2223 002462 001000
000042
32740
SHLD
ARYTAB
;SAVE IN START OF ARRAY SPACE
2224 002463 000000
001623'
2225 002464 000000
002460°
2226
002465 001000
060642
32760
SHLD
STREND
;AND END OF VARIABLE STORAGE
2227
002466 000000
001625'
2228
002467
000000
002463'
2229
32780
2230
32800
STKINI RESETS THE STACK POINTER ELIMINATING
2231
32820
GOSUB & FOR CONTEXT. STRING TEMPORARIES ARE FREED
2232
32840
UP, SUBFLG IS RESET, CONTINUING IS DISALLOWED,
2233
32860
AND A DUMMY ENTRY IS PUT ON THE STACK. THIS IS SO
2234
32880
FNDFOR WILL ALWAYS FIND A NON-"FOR" ENTRY AT THE BOTTOM
2235
32900
OF THE STACK. (A) AND [D,E] IS PRESERVED.
2236
32920
BASIC MCS 8080 GATES/ALLEN/DAVIDOFF
MACRO 47(113) 03:12 10-SEP-75 PAGE 8-7
F3
MAC
6-SEP-64 03:11
ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
2237 002470° 001000 000301
32940
STKINI: POP
8
IGET RETURN ADDRESS HERE
2238 002471 001000 000052
32960
LHLD
STKTOP
1(H,L) POINTER TO END OF MEMORY
2239 002472' 000000 001615'
2240 002473 000000 002466
2241 002474 001000 000371
32980
SPHL
;INITIALIZE STACK
2242
33000
IFN
STRING,
2243 002475' 001000
000641
33020
LXI
H,TEMPST
2244 002476 000000
001551
2245 002477° 000000
002472'
2246 002500 001000
000042
33040
SHLO
TEMPPT>
;INITIALIZE STRING TEMPORARIES
2247 002501 000000
001547
2248 002502 000000
002476
2249 002503' 001000
000041
33060
LXI
H,SCODE
;PUT ZERO (NON NEXT, FOR, GOSUB TOKEN)
2250 002504 000000
000000
2251 002505 000000
002501
2252
002506 001000
000345
33080
PUSH
H
ION STACK
2253
002507 001000
080042
33100
IFN
LENGTH, <SHLD
OLDTXT> ;MAKE CONTINUING ILLEGAL
2254
002510 000000
001613
2255
002511 000000 002504
2256
33120
IFN
LPTSW,<
2257
33140
CALL
FINLPT>
2258 002512 001000 000052
33160
LHLD
TEMP
;GET SAVED [H,L]
2259
002513 000000 001603
2260
002514 000000 002510
2261
33180
IFN
LENGTH,
2262
33200
IFE
CONTRW, <XRA
A>
2263
002515 001000 000062
33220
STA
SUBFLG>
IALLOW SUBSCRIPTS
2264 002516 000000 001601
2265 002517 000000 002513
2266 002520 001000 060305
33240
PUSH
8
;PUT RETURN ADDRESS BACK ON
2267
002521 001000
000311
33260
RET
;GO BACK
2268
2269 002522' 001000
000076
33300
QINLIN: MVI
A,"?"
;GET A QMARK
2270 002523 000000 000077
2271 002524 001000 000337
33320
OUTCHR
;TYPE IT
2272 002525 001000 000076
33340
MVI
A, "
;SPACE
2273 002526 000000 000040
2274 002527 001000 000337
33360
OUTCHR
;TYPE IT TOO
2275
33380
IFE
STRING,<CALL
INLIN
;IN THE NON-STRING VERSIONS ALL
2276
33400
;INPUT IS CRUNCHED
2277
33420
INX
H>
;GET A LINE OF INPUT FROM TTY
2278 002530 001000 000303
33440
IFN
STRING, <JMP
INLIN>
;NO CRUNCHING IN THIS CASE
2279
002531 000000 002776
2280
002532 000000 002516
2281
33460
2282
33520
ALL "RESERVED" WORDS ARE TRANSLATED INTO SINGLE
2283
33540
BYTES WITH THE MSB ON. THIS SAVES SPACE AND TIME
2284
33560
BY ALLOWING FOR TABLE DISPATCH DURING EXECUTION.
2285
33580
THEREFORE ALL STATEMENTS APPEAR TOGETHER IN THE
2286
33600
RESERVED WORD LIST IN THE SAME
I
2287
33620
ORDER THEY APPEAR IN IN STMDSP.
2288
33640
2289 002533
33700
CRUNCH: IFN
STRING,